import 'package:basics/helpers/classes/checks/tracers.dart';
import 'package:basics/helpers/classes/strings/text_check.dart';
import 'package:basics/helpers/classes/strings/text_mod.dart';
import 'package:bldrs/a_models/d_zone/b_country/country_model.dart';
import 'package:bldrs/a_models/d_zone/c_city/city_model.dart';
import 'package:bldrs/b_views/z_components/texting/super_verse/verse_model.dart';
import 'package:bldrs/c_protocols/main_providers/ui_provider.dart';
import 'package:bldrs/c_protocols/phrase_protocols/provider/phrase_provider.dart';
import 'package:bldrs/c_protocols/zone_protocols/modelling_protocols/protocols/a_zone_protocols.dart';
import 'package:bldrs/c_protocols/zone_protocols/modelling_protocols/provider/zone_provider.dart';
import 'package:bldrs/f_helpers/localization/localizer.dart';
import 'package:bldrs/world_zoning/world_zoning.dart';
import 'package:flutter/material.dart';
/// => TAMAM
@immutable
class ZoneModel {
  /// --------------------------------------------------------------------------
  const ZoneModel({
    required this.countryID,
    this.cityID,
    this.countryName,
    this.cityName,
    this.countryModel,
    this.cityModel,
    this.icon,
  });
  /// --------------------------------------------------------------------------
  final String? countryID;
  final String? cityID;
  final String? countryName;
  final String? cityName;
  final CountryModel? countryModel;
  final CityModel? cityModel;
  final String? icon;
  // -----------------------------------------------------------------------------

  /// INITIALIZATION

  // --------------------
  /// TESTED : WORKS PERFECT
  static Future<ZoneModel?> prepareZoneForEditing({
    required ZoneModel? zoneModel,
  }) async {

    final ZoneModel? _zone =
            zoneModel
            ??
            ZoneProvider.proGetCurrentZone(context: getMainContext(), listen: false)
            ??
            await ZoneProtocols.getZoneByIP();

    return ZoneProtocols.completeZoneModel(
      incompleteZoneModel: _zone,
    );

  }
  // -----------------------------------------------------------------------------

  /// CLONING

  // --------------------
  /// TESTED : WORKS PERFECT
  ZoneModel copyWith({
    String? countryID,
    String? cityID,
    String? countryName,
    String? cityName,
    CountryModel? countryModel,
    CityModel? cityModel,
    String? icon,
  }){
    return ZoneModel(
      countryID: countryID ?? this.countryID,
      cityID: cityID ?? this.cityID,
      countryName: countryName ?? this.countryName,
      cityName: cityName ?? this.cityName,
      countryModel: countryModel ?? this.countryModel,
      cityModel: cityModel ?? this.cityModel,
      icon: icon ?? this.icon,
    );
  }
  // --------------------
  /// TESTED : WORKS PERFECT
  ZoneModel nullifyField({
    bool countryID = false,
    bool cityID = false,
    bool countryName = false,
    bool cityName = false,
    bool countryModel = false,
    bool cityModel = false,
    bool icon = false,
  }){
    return ZoneModel(
      countryID: countryID == true ? null : this.countryID,
      cityID: cityID == true ? null : this.cityID,
      countryName: countryName == true ? null : this.countryName,
      cityName: cityName == true ? null : this.cityName,
      countryModel: countryModel == true ? null : this.countryModel,
      cityModel: cityModel == true ? null : this.cityModel,
      icon: icon == true ? null : this.icon,
    );
  }
  // -----------------------------------------------------------------------------

  /// CYPHERS

  // --------------------
  /// TESTED : WORKS PERFECT
  Map<String, dynamic> toMap() {
    return <String, dynamic>{
      'countryID': countryID,
      'cityID': cityID,
    };
  }
  // --------------------
  /// TESTED : WORKS PERFECT
  static ZoneModel? decipherZone(Map<String, dynamic>? map) {


    if (map == null){
      return null;
    }

    else {
      return ZoneModel(
        countryID: map['countryID'],
        cityID: map['cityID'],
      );
    }

  }
  // --------------------
  /// TESTED : WORKS PERFECT
  String cipherToString() {
    return '$countryID/$cityID';
  }
  // --------------------
  /// TESTED : WORKS PERFECT
  static ZoneModel decipherZoneString(String zoneString) {

    final String? _countryID = TextMod.removeTextAfterFirstSpecialCharacter(
        text: zoneString,
        specialCharacter: '/',
    );
    final String? _cityID = TextMod.removeTextBeforeFirstSpecialCharacter(
        text: zoneString,
        specialCharacter: '/',
    );

    return ZoneModel(
      countryID: _countryID,
      cityID: _cityID,
    );
  }
  // -----------------------------------------------------------------------------

  /// CHECKERS

  // --------------------
  /// TESTED : WORKS PERFECT
  bool isNotEmpty() {
    final bool _isEmpty = TextCheck.isEmpty(countryID) == false;
    final bool _isNotEmpty = !_isEmpty;
    return _isNotEmpty;
  }
  // --------------------
  /// TESTED : WORKS PERFECT
  static bool zoneHasAllIDs(ZoneModel? zone) {
    final bool _hasAllIDs = zone != null &&
        zone.countryID != null &&
        zone.cityID != null;
    return _hasAllIDs;
  }
  // --------------------
  /// TESTED : WORKS PERFECT
  static bool checkZoneHasCountryAndCityIDs(ZoneModel? zone){
    final bool _has = zone != null &&
        zone.countryID != null &&
        zone.cityID != null;
    return _has;
  }
  // -----------------------------------------------------------------------------

  /// BLOGGING

  // --------------------
  /// TESTED : WORKS PERFECT
  void blogZone({String invoker = 'ZONE - PRINT'}) {
    blog('$invoker ------------------------------- START');

    blog('  IDs [ $cityID - $countryID ]');
    blog('  names [ $cityName - $countryName ]');
    blog('  models [ cityModelExists : ${cityModel != null} / countryModelExists : ${countryModel != null} ]');

    blog('$invoker ------------------------------- END');
  }
  // --------------------
  /// TESTED : WORKS PERFECT
  void blogZoneIDs({String invoker = 'ZONE-IDs BLOG : '}){

    blog('$invoker [ $cityID - $countryID ]');

  }
  // --------------------
  /// TESTED : WORKS PERFECT
  static void blogZonesDifferences({
    required ZoneModel? zone1,
    required ZoneModel? zone2,
  }){

    blog('blogZonesDifferences ---------- START');

    if (zone1 == null){
      blog('blogBzzDifferences : zone1 = null');
    }
    if (zone2 == null){
      blog('blogBzzDifferences : zone2 = null');
    }
    if (zone1 != null && zone2 != null){

      if (zone1.countryID != zone2.countryID){
        blog('countryIDs are not Identical');
      }
      if (zone1.cityID != zone2.cityID){
        blog('cityIDs are not Identical');
      }
      if (zone1.countryName != zone2.countryName){
        blog('countryNames are not Identical');
      }
      if (zone1.cityName != zone2.cityName){
        blog('cityNames are not Identical');
      }
      if (CountryModel.checkCountriesAreIdentical(zone1.countryModel, zone2.countryModel) == false){
        blog('countryModels are not Identical');
      }
      if (CityModel.checkCitiesAreIdentical(zone1.cityModel, zone2.cityModel) == false){
        blog('cityModels are not Identical');
      }
      if (zone1.icon != zone2.icon){
        blog('flags are not Identical');
      }

    }

    blog('blogZonesDifferences ---------- END');
  }
  // -----------------------------------------------------------------------------

  /// DUMMIES

  // --------------------
  /// TESTED : WORKS PERFECT
  static ZoneModel dummyZone() {
    return const ZoneModel(
      countryID: 'egy',
      cityID: 'egy+cairo',
    );
  }
  // -----------------------------------------------------------------------------

  /// STRING GENERATORS

  // --------------------
  /// TESTED : WORKS PERFECT
  static Verse generateInZoneVerse ({
    required ZoneModel? zoneModel,
    bool showCity = true,
  }){

    // zoneModel?.blogZone(invoker: 'translateZoneString');

    String _text = '...';
    final String? _inn = xPhrase('phid_inn');

    if (zoneModel != null){

      if (zoneModel.countryID != null){

        final String? _countryName = Flag.translateCountry(
          langCode: Localizer.getCurrentLangCode(),
          countryID: zoneModel.countryID,
        );

        _text = '$_inn $_countryName';


        if (showCity == true && (zoneModel.cityModel != null || zoneModel.cityName != null)){

          final String? _cityName = zoneModel.cityName ?? CityModel.translateCity(
            city: zoneModel.cityModel,
          );

          _text = '$_inn $_cityName, $_countryName';

        }

      }

    }

    return Verse(
      id: _text,
      translate: false,
    );
  }
  // --------------------
  /// TESTED : WORKS PERFECT
  static Verse generateObeliskVerse({
    required ZoneModel? zone,
  }){

    String? _line = xPhrase('phid_select_a_country');

    if (zone != null){

      final String? _countryName = Flag.translateCountry(
        langCode: Localizer.getCurrentLangCode(),
        countryID: zone.countryID,
      );

      final String? _cityName = CityModel.translateCity(
        city: zone.cityModel,
      );

      if (_countryName != null && _countryName != '...'){

        _line = _countryName;

        if (_cityName != null && _cityName != '...'){

          _line = '$_cityName, $_countryName';

        }

      }

      else {
        _line = xPhrase('phid_the_entire_world');
      }

    }

    return Verse(
      id: _line,
      translate: false,
    );
  }
  // -----------------------------------------------------------------------------

  /// EQUALITY

  // --------------------
  /// TESTED : WORKS PERFECT
  static bool checkZonesAreIdentical({
    required ZoneModel? zone1,
    required ZoneModel? zone2,
  }){
    bool _identical = false;

    if (zone1 == null && zone2 == null){
      _identical = true;
    }

    else if (zone1 != null && zone2 != null){

      if (
          zone1.countryID == zone2.countryID &&
          zone1.cityID == zone2.cityID &&
          zone1.countryName == zone2.countryName &&
          zone1.cityName == zone2.cityName &&
          CountryModel.checkCountriesAreIdentical(zone1.countryModel, zone2.countryModel) == true &&
          CityModel.checkCitiesAreIdentical(zone1.cityModel, zone2.cityModel) == true &&
          zone1.icon == zone2.icon
      ){
        _identical = true;
      }

    }

    // if (_identical == false){
    //   blogZonesDifferences(
    //     zone1: zone1,
    //     zone2: zone2,
    //   );
    // }

    return _identical;
  }
  // --------------------
  /// TESTED : WORKS PERFECT
  static bool checkZonesIDsAreIdentical({
    required ZoneModel? zone1,
    required ZoneModel? zone2,
  }) {
    bool _zonesAreIdentical = false;

    if (
        zone1?.countryID    == zone2?.countryID &&
        zone1?.cityID       == zone2?.cityID
    ){
      _zonesAreIdentical = true;
    }

    return _zonesAreIdentical;
  }
  // -----------------------------------------------------------------------------

  /// OVERRIDES

  // --------------------
   @override
   String toString(){

    final String _blog =
    '''
    ZoneModel(
      countryID: $countryID,
      cityID: $cityID,
      countryName: $countryName,
      cityName: $cityName,
      countryModel: $countryModel,
      cityModel: $cityModel,
      icon: $icon,
    );
    ''';

    return _blog;
   }
  // --------------------
  /// TESTED : WORKS PERFECT
  @override
  bool operator == (Object other){

    if (identical(this, other)) {
      return true;
    }

    bool _areIdentical = false;
    if (other is ZoneModel){
      _areIdentical = checkZonesAreIdentical(
        zone1: this,
        zone2: other,
      );
    }

    return _areIdentical;
  }
  // --------------------
  @override
  int get hashCode =>
      countryID.hashCode ^
      cityID.hashCode ^
      countryName.hashCode ^
      cityName.hashCode ^
      countryModel.hashCode ^
      cityModel.hashCode ^
      icon.hashCode;
  // -----------------------------------------------------------------------------
}
